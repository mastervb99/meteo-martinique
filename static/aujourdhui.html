<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>M√©t√©o Aujourd'hui ‚Äî Martinique | M√©t√©o Martinique</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f4f8fb;--surface:#ffffff;--text:#0b1220;--muted:#66768a;--border:rgba(15,23,42,.10);--border2:rgba(15,23,42,.06);--shadow:0 16px 40px rgba(15,23,42,.10);--shadowSoft:0 10px 26px rgba(15,23,42,.08);--radius:18px;--radiusL:22px;--blue:#2563eb;--cyan:#06b6d4;--sky:#0ea5e9;--ink:#0f172a;--green:#22c55e;--yellow:#eab308;--orange:#f97316;--red:#ef4444;}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:radial-gradient(900px 500px at 10% 0%,rgba(37,99,235,.10),transparent 60%),radial-gradient(900px 500px at 90% 0%,rgba(6,182,212,.10),transparent 55%),var(--bg);}
    .container{max-width:1320px;margin:0 auto;padding:22px 18px 44px;}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.72);backdrop-filter:blur(12px);border-bottom:1px solid var(--border2);}
    .header-inner{max-width:1320px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:14px;}
    .brand{display:flex;align-items:center;gap:12px;min-width:260px;text-decoration:none;color:inherit;}
    .brand-badge{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;color:#fff;font-weight:900;background:linear-gradient(135deg,var(--blue),var(--cyan));box-shadow:0 14px 28px rgba(37,99,235,.18);}
    .brand-title{display:flex;flex-direction:column;line-height:1.1;}
    .brand-title strong{font-size:20px;font-weight:900;letter-spacing:-.02em;}
    .brand-title span{font-size:12px;color:var(--muted);font-weight:600;}
    nav{display:flex;gap:22px;align-items:center;}
    nav a{text-decoration:none;color:#334155;font-weight:800;font-size:14px;padding:10px 12px;border-radius:12px;transition:.15s ease;}
    nav a:hover{background:rgba(37,99,235,.08);color:#1d4ed8;}
    nav a.active{background:rgba(37,99,235,.12);color:#1d4ed8;}
    .card{background:var(--surface);border:1px solid var(--border2);border-radius:var(--radiusL);box-shadow:var(--shadowSoft);}
    .section{padding:20px;}
    .section-title{margin:0;font-size:18px;font-weight:900;letter-spacing:-.02em;}
    .section-sub{margin:6px 0 0;color:var(--muted);font-weight:600;font-size:13px;}
    .hero{overflow:hidden;border-radius:var(--radiusL);border:1px solid rgba(37,99,235,.18);box-shadow:var(--shadow);margin-bottom:20px;}
    .hero-bar{background:linear-gradient(90deg,var(--blue),var(--cyan));color:#fff;padding:22px 22px 18px;display:flex;align-items:flex-start;justify-content:space-between;gap:14px;}
    .hero-bar h1{margin:0;font-size:22px;font-weight:950;letter-spacing:-.02em;}
    .hero-bar p{margin:6px 0 0;opacity:.95;font-weight:600;}
    .vigilance-badge{padding:12px 18px;border-radius:14px;font-weight:900;display:flex;align-items:center;gap:10px;}
    .vigilance-green{background:rgba(34,197,94,.15);color:#15803d;border:1px solid rgba(34,197,94,.3);}
    .vigilance-yellow{background:rgba(234,179,8,.15);color:#a16207;border:1px solid rgba(234,179,8,.3);}
    .vigilance-orange{background:rgba(249,115,22,.15);color:#c2410c;border:1px solid rgba(249,115,22,.3);}
    .vigilance-red{background:rgba(239,68,68,.15);color:#b91c1c;border:1px solid rgba(239,68,68,.3);}
    .city-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;padding:20px;}
    .city-card{background:#fff;border:1px solid var(--border2);border-radius:16px;padding:18px;transition:.2s ease;}
    .city-card:hover{box-shadow:var(--shadow);transform:translateY(-2px);}
    .city-name{font-size:16px;font-weight:900;margin:0 0 12px;display:flex;align-items:center;gap:8px;}
    .city-temp{font-size:36px;font-weight:950;letter-spacing:-.03em;color:var(--blue);}
    .city-temp small{font-size:14px;color:var(--muted);font-weight:700;}
    .city-details{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;}
    .city-detail{display:flex;align-items:center;gap:6px;font-size:13px;font-weight:700;color:var(--muted);}
    .city-detail span{color:var(--ink);}
    .city-desc{margin-top:10px;padding-top:10px;border-top:1px solid var(--border2);font-size:13px;font-weight:700;color:var(--muted);}
    .loading{text-align:center;padding:60px;color:var(--muted);font-weight:700;}
    .btn{border:none;background:linear-gradient(135deg,#0ea5e9,#2563eb);color:#fff;padding:10px 16px;border-radius:14px;font-weight:900;cursor:pointer;}
    footer{margin-top:26px;background:radial-gradient(1200px 600px at 20% 0%,rgba(37,99,235,.18),transparent 55%),radial-gradient(1200px 600px at 80% 0%,rgba(6,182,212,.18),transparent 55%),#0b1220;color:white;padding:44px 18px 34px;}
    .footer-inner{max-width:1320px;margin:0 auto;text-align:center;}
    footer p{margin:0;color:rgba(148,163,184,.92);font-weight:700;font-size:13px;}
    @media(max-width:900px){nav{display:none;}.city-grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <a href="/" class="brand">
      <div class="brand-badge">üå§Ô∏è</div>
      <div class="brand-title"><strong>M√©t√©o Martinique</strong><span>Pr√©visions & vigilance en temps r√©el</span></div>
    </a>
    <nav>
      <a class="active" href="/aujourd-hui">Aujourd'hui</a>
      <a href="/previsions">Pr√©visions</a>
      <a href="/cartes">Cartes</a>
      <a href="/">Alertes</a>
    </nav>
  </div>
</header>

<main class="container">
  <section class="hero">
    <div class="hero-bar">
      <div>
        <h1>M√©t√©o Aujourd'hui ‚Äî Martinique</h1>
        <p>Conditions actuelles pour les principales villes de l'√Æle.</p>
      </div>
      <div id="vigilanceBadge" class="vigilance-badge vigilance-green">
        <span>Vigilance</span>
        <strong id="vigilanceLevel">Verte</strong>
      </div>
    </div>
    <div id="cityGrid" class="city-grid">
      <div class="loading">Chargement des donn√©es m√©t√©o...</div>
    </div>
  </section>

  <section class="card section" style="display:flex;align-items:center;justify-content:space-between;gap:20px;flex-wrap:wrap;">
    <div>
      <h2 class="section-title">Donn√©es de d√©monstration</h2>
      <p class="section-sub">G√©n√©rer des donn√©es m√©t√©o de test pour visualiser le tableau de bord.</p>
    </div>
    <button id="generateBtn" class="btn">G√©n√©rer donn√©es d√©mo</button>
  </section>
</main>

<footer>
  <div class="footer-inner">
    <p>¬© 2024 M√©t√©o Martinique. Tous droits r√©serv√©s.</p>
  </div>
</footer>

<script>
  const cityGrid = document.getElementById('cityGrid');
  const vigilanceBadge = document.getElementById('vigilanceBadge');
  const vigilanceLevel = document.getElementById('vigilanceLevel');
  const generateBtn = document.getElementById('generateBtn');

  const vigilanceClasses = {
    1: { class: 'vigilance-green', text: 'Verte' },
    2: { class: 'vigilance-yellow', text: 'Jaune' },
    3: { class: 'vigilance-orange', text: 'Orange' },
    4: { class: 'vigilance-red', text: 'Rouge' }
  };

  function renderCity(city) {
    return `
      <div class="city-card">
        <h3 class="city-name">üìç ${city.city || city.name}</h3>
        <div class="city-temp">
          ${city.temp_max ? Math.round(city.temp_max) : '--'}¬∞
          <small>/ ${city.temp_min ? Math.round(city.temp_min) : '--'}¬∞C</small>
        </div>
        <div class="city-details">
          <div class="city-detail">üíß <span>${city.humidity || '--'}%</span></div>
          <div class="city-detail">üåßÔ∏è <span>${city.precipitation || 0} mm</span></div>
          <div class="city-detail">üí® <span>${city.wind_speed || '--'} km/h</span></div>
          <div class="city-detail">‚òÄÔ∏è UV <span>${city.uv_index || '--'}</span></div>
        </div>
        ${city.weather_desc ? `<div class="city-desc">${city.weather_desc}</div>` : ''}
      </div>
    `;
  }

  async function loadWeather() {
    try {
      const res = await fetch('/api/weather/current');
      const data = await res.json();

      // Update vigilance
      if (data.vigilance && data.vigilance.max_color) {
        const v = vigilanceClasses[data.vigilance.max_color] || vigilanceClasses[1];
        vigilanceBadge.className = 'vigilance-badge ' + v.class;
        vigilanceLevel.textContent = v.text;
      }

      // Render cities
      if (data.cities && data.cities.length > 0) {
        cityGrid.innerHTML = data.cities.map(renderCity).join('');
      } else if (data.martinique && data.martinique.major_cities) {
        cityGrid.innerHTML = data.martinique.major_cities.map(c => renderCity({name: c.name})).join('');
      } else {
        cityGrid.innerHTML = '<div class="loading">Aucune donn√©e disponible. Cliquez sur "G√©n√©rer donn√©es d√©mo".</div>';
      }
    } catch (e) {
      cityGrid.innerHTML = '<div class="loading">Erreur de chargement. Cliquez sur "G√©n√©rer donn√©es d√©mo".</div>';
    }
  }

  generateBtn.addEventListener('click', async () => {
    generateBtn.disabled = true;
    generateBtn.textContent = 'G√©n√©ration...';
    try {
      await fetch('/api/generate/demo', { method: 'POST' });
      await loadWeather();
    } catch (e) {
      alert('Erreur: ' + e.message);
    }
    generateBtn.disabled = false;
    generateBtn.textContent = 'G√©n√©rer donn√©es d√©mo';
  });

  loadWeather();
</script>
</body>
</html>
