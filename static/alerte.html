<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Alertes Meteo | Meteo Martinique</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f4f8fb;--surface:#ffffff;--text:#0b1220;--muted:#66768a;--border:rgba(15,23,42,.10);--border2:rgba(15,23,42,.06);--shadow:0 16px 40px rgba(15,23,42,.10);--shadowSoft:0 10px 26px rgba(15,23,42,.08);--radius:18px;--radiusL:22px;--blue:#2563eb;--cyan:#06b6d4;--green:#22c55e;--danger:#ef4444;--ink:#0f172a;}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:radial-gradient(900px 500px at 10% 0%,rgba(37,99,235,.10),transparent 60%),radial-gradient(900px 500px at 90% 0%,rgba(6,182,212,.10),transparent 55%),var(--bg);}
    .container{max-width:1000px;margin:0 auto;padding:22px 18px 44px;}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.72);backdrop-filter:blur(12px);border-bottom:1px solid var(--border2);}
    .header-inner{max-width:1320px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;gap:14px;}
    .brand{display:flex;align-items:center;gap:12px;}
    .brand-badge{width:44px;height:44px;border-radius:14px;display:grid;place-items:center;color:#fff;font-weight:900;background:linear-gradient(135deg,var(--blue),var(--cyan));box-shadow:0 14px 28px rgba(37,99,235,.18);}
    .brand-title{display:flex;flex-direction:column;line-height:1.1;}
    .brand-title strong{font-size:20px;font-weight:900;letter-spacing:-.02em;}
    .brand-title span{font-size:12px;color:var(--muted);font-weight:600;}
    nav{display:flex;gap:22px;align-items:center;}
    nav a{text-decoration:none;color:#334155;font-weight:800;font-size:14px;padding:10px 12px;border-radius:12px;transition:.15s ease;}
    nav a:hover{background:rgba(37,99,235,.08);color:#1d4ed8;}
    nav a.active{background:rgba(37,99,235,.12);color:#1d4ed8;}

    .hero{text-align:center;padding:48px 24px;background:linear-gradient(135deg,rgba(37,99,235,.08),rgba(6,182,212,.08));border-radius:var(--radiusL);margin-bottom:32px;}
    .hero h1{margin:0;font-size:36px;font-weight:950;letter-spacing:-.03em;background:linear-gradient(135deg,var(--blue),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .hero p{margin:12px 0 0;font-size:18px;color:var(--muted);font-weight:600;max-width:500px;margin-left:auto;margin-right:auto;}

    .plans{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:32px;}
    .plan-card{background:var(--surface);border-radius:var(--radiusL);overflow:hidden;box-shadow:var(--shadow);border:2px solid transparent;transition:transform .2s ease,border-color .2s ease;}
    .plan-card:hover{transform:translateY(-4px);}
    .plan-card.sms{border-color:rgba(37,99,235,.2);}
    .plan-card.sms:hover{border-color:rgba(37,99,235,.4);}
    .plan-card.email{border-color:rgba(34,197,94,.2);}
    .plan-card.email:hover{border-color:rgba(34,197,94,.4);}

    .plan-header{padding:24px;text-align:center;}
    .plan-header.sms{background:linear-gradient(135deg,var(--blue),var(--cyan));color:#fff;}
    .plan-header.email{background:linear-gradient(135deg,var(--green),var(--cyan));color:#fff;}
    .plan-icon{width:56px;height:56px;background:rgba(255,255,255,.2);border-radius:16px;display:grid;place-items:center;margin:0 auto 12px;font-size:28px;}
    .plan-title{margin:0;font-size:24px;font-weight:950;}
    .plan-price{margin:8px 0 0;font-size:32px;font-weight:950;}
    .plan-price span{font-size:16px;opacity:.8;font-weight:700;}
    .plan-badge{display:inline-block;margin-top:8px;background:rgba(255,255,255,.25);padding:4px 12px;border-radius:999px;font-size:12px;font-weight:800;}

    .plan-body{padding:24px;}
    .plan-features{list-style:none;margin:0;padding:0;}
    .plan-features li{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--border2);font-weight:700;color:#334155;}
    .plan-features li:last-child{border-bottom:0;}
    .plan-features svg{width:20px;height:20px;flex-shrink:0;}
    .plan-features .sms-check{color:var(--blue);}
    .plan-features .email-check{color:var(--green);}

    .plan-cta{padding:0 24px 24px;}
    .btn{display:block;text-align:center;text-decoration:none;border:0;padding:16px 24px;border-radius:14px;font-weight:900;cursor:pointer;width:100%;font-size:16px;transition:transform .12s ease,filter .12s ease;}
    .btn:hover{filter:brightness(.98);transform:translateY(-2px);}
    .btn.sms{background:linear-gradient(135deg,#0ea5e9,#2563eb);color:#fff;box-shadow:0 16px 30px rgba(14,165,233,.18);}
    .btn.email{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;box-shadow:0 16px 30px rgba(34,197,94,.18);}

    .manage-section{background:var(--surface);border-radius:var(--radiusL);padding:24px;box-shadow:var(--shadowSoft);}
    .manage-section h2{margin:0 0 8px;font-size:18px;font-weight:900;}
    .manage-section p{margin:0 0 16px;color:var(--muted);font-weight:600;font-size:14px;}
    .manage-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .field{display:flex;flex-direction:column;gap:6px;}
    .label{font-size:12px;font-weight:900;color:#334155;}
    .control{border-radius:12px;border:1px solid var(--border);background:#fff;padding:12px;font-weight:700;color:var(--ink);outline:none;}
    .control:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.1);}
    .manage-btns{display:flex;gap:10px;margin-top:16px;}
    .btn-soft{border:1px solid rgba(37,99,235,.18);background:rgba(255,255,255,.85);color:#1d4ed8;padding:12px 16px;border-radius:12px;font-weight:900;cursor:pointer;}
    .btn-soft:hover{background:#fff;}
    .btn-danger{background:linear-gradient(90deg,#f97316,#ef4444);color:#fff;border:0;padding:12px 16px;border-radius:12px;font-weight:900;cursor:pointer;box-shadow:0 12px 24px rgba(239,68,68,.16);}
    .toast{display:none;margin-top:16px;padding:12px;border-radius:12px;font-weight:800;text-align:center;}
    .toast.ok{display:block;background:rgba(34,197,94,.08);color:#15803d;border:1px solid rgba(34,197,94,.22);}
    .toast.err{display:block;background:rgba(239,68,68,.08);color:#b91c1c;border:1px solid rgba(239,68,68,.22);}

    .faq{margin-top:32px;}
    .faq h2{margin:0 0 16px;font-size:18px;font-weight:900;}
    .faq-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    details{background:var(--surface);border:1px solid var(--border2);border-radius:14px;padding:14px;}
    summary{cursor:pointer;font-weight:900;list-style:none;}
    summary::-webkit-details-marker{display:none;}
    details p{margin:10px 0 0;color:var(--muted);font-weight:700;line-height:1.7;}

    footer{margin-top:32px;background:#0b1220;color:white;padding:32px 18px;border-radius:var(--radiusL);}
    .footer-inner{max-width:1000px;margin:0 auto;text-align:center;}
    footer p{margin:0;color:rgba(226,232,240,.7);font-weight:600;font-size:13px;}

    @media(max-width:768px){nav{display:none;}.plans{grid-template-columns:1fr;}.manage-grid{grid-template-columns:1fr;}.faq-grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="brand">
      <div class="brand-badge">M</div>
      <div class="brand-title"><strong>Meteo Martinique</strong><span>Previsions & vigilance en temps reel</span></div>
    </div>
    <nav>
      <a href="/aujourd-hui">Aujourd'hui</a>
      <a href="/previsions">Previsions</a>
      <a href="/cartes">Cartes</a>
      <a class="active" href="/">Alertes</a>
    </nav>
  </div>
</header>

<main class="container">
  <div class="hero">
    <h1>Alertes Meteo Martinique</h1>
    <p>Recevez les alertes vigilance (orages, vent, houle, cyclone) directement sur votre telephone ou par email.</p>
  </div>

  <div class="plans">
    <div class="plan-card sms">
      <div class="plan-header sms">
        <div class="plan-icon">SMS</div>
        <h2 class="plan-title">Alertes SMS</h2>
        <div class="plan-price">4,99 EUR<span>/mois</span></div>
        <div class="plan-badge">Recommande</div>
      </div>
      <div class="plan-body">
        <ul class="plan-features">
          <li><svg class="sms-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Alertes SMS instantanees</li>
          <li><svg class="sms-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Tous phenomenes meteo</li>
          <li><svg class="sms-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Conseils adaptes au profil</li>
          <li><svg class="sms-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Desinscription STOP</li>
        </ul>
      </div>
      <div class="plan-cta">
        <a href="/alerte-sms" class="btn sms">S'abonner aux alertes SMS</a>
      </div>
    </div>

    <div class="plan-card email">
      <div class="plan-header email">
        <div class="plan-icon">@</div>
        <h2 class="plan-title">Alertes Email</h2>
        <div class="plan-price">10 EUR<span>/an</span></div>
        <div class="plan-badge">Economique</div>
      </div>
      <div class="plan-body">
        <ul class="plan-features">
          <li><svg class="email-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Alertes email detaillees</li>
          <li><svg class="email-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Previsions completes</li>
          <li><svg class="email-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Cartes meteo incluses</li>
          <li><svg class="email-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Resiliation libre</li>
        </ul>
      </div>
      <div class="plan-cta">
        <a href="/alerte-email" class="btn email">S'abonner aux alertes Email</a>
      </div>
    </div>
  </div>

  <div class="manage-section">
    <h2>Gerer mon abonnement</h2>
    <p>Changer de profil ou se desinscrire.</p>
    <div class="manage-grid">
      <div class="field">
        <label class="label" for="managePhone">Numero ou Email</label>
        <input id="managePhone" class="control" type="text" placeholder="+596 696 12 34 56 ou email@example.fr">
      </div>
      <div class="field">
        <label class="label" for="manageRef">Code Reference</label>
        <input id="manageRef" class="control" type="text" placeholder="Ex: MM-4F9A2">
      </div>
    </div>
    <div class="manage-btns">
      <button id="updateBtn" class="btn-soft" type="button">Mettre a jour</button>
      <button id="unsubBtn" class="btn-danger" type="button">Se desinscrire</button>
    </div>
    <div id="manageToast" class="toast"></div>
  </div>

  <div class="faq">
    <h2>Questions frequentes</h2>
    <div class="faq-grid">
      <details>
        <summary>Quels phenomenes sont couverts?</summary>
        <p>Tous: orages, pluies intenses, vent fort, houle/submersion, chaleur extreme, cyclone/ouragan.</p>
      </details>
      <details>
        <summary>Comment me desinscrire?</summary>
        <p>SMS: envoyez STOP. Email: cliquez sur le lien de desinscription ou utilisez la section "Gerer mon abonnement".</p>
      </details>
      <details>
        <summary>Mes donnees sont-elles partagees?</summary>
        <p>Non. Seuls le contact et les preferences necessaires sont stockes.</p>
      </details>
      <details>
        <summary>Comment fonctionnent les alertes?</summary>
        <p>Des qu'une vigilance jaune, orange ou rouge est emise par Meteo France, vous recevez une alerte avec des conseils adaptes.</p>
      </details>
    </div>
  </div>
</main>

<footer>
  <div class="footer-inner">
    <p>2024 Meteo Martinique. Tous droits reserves.</p>
  </div>
</footer>

<script>
const API_BASE = '/api';
const managePhone = document.getElementById('managePhone');
const manageRef = document.getElementById('manageRef');
const updateBtn = document.getElementById('updateBtn');
const unsubBtn = document.getElementById('unsubBtn');
const manageToast = document.getElementById('manageToast');

function showToast(type, msg) {
  manageToast.className = 'toast ' + type;
  manageToast.textContent = msg;
}

async function handleUnsubscribe() {
  const contact = managePhone.value.trim();
  const ref = manageRef.value.trim();

  if (!contact && !ref) {
    showToast('err', 'Entrez un numero/email ou un code reference.');
    return;
  }

  try {
    const payload = {};
    if (contact.includes('@')) {
      payload.email = contact;
    } else {
      payload.phone = contact;
    }
    if (ref) payload.reference_code = ref;

    const res = await fetch(API_BASE + '/subscribe/unsubscribe', {
      method: 'DELETE',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    });

    if (res.ok) {
      showToast('ok', 'Desabonne avec succes.');
    } else {
      const err = await res.json();
      showToast('err', err.detail || 'Erreur lors de la desinscription.');
    }
  } catch (err) {
    showToast('err', 'Erreur de connexion.');
  }
}

updateBtn.addEventListener('click', () => {
  showToast('err', 'Pour mettre a jour, veuillez vous desinscrire puis vous reinscrire.');
});

unsubBtn.addEventListener('click', handleUnsubscribe);
</script>
</body>
</html>
